# 测试覆盖率与鲁棒性报告

## 概述
本项目采用了基于 Playwright 和 Mocha 的集成测试策略，辅以针对性的鲁棒性测试，以确保应用在 Electron 环境下的稳定性。

## 测试文件结构
- `test/integration.test.js`：涵盖应用核心功能的 happy-path 测试。
- `test/robustness.test.js`：涵盖边界条件、错误恢复和安全性的压力测试。

## 测试覆盖范围

### 1. 核心功能 (Functional)
| 功能模块 | 测试点 | 覆盖情况 | 备注 |
|---------|-------|---------|------|
| **启动流程** | 应用初始化、窗口创建 | ✅ | 包含启动时间监控 |
| **菜单系统** | 菜单创建、菜单项完整性 | ✅ | 验证了标准菜单和开发者工具 |
| **托盘图标** | 创建、销毁 | ✅ | |
| **窗口管理** | 最小化、最大化、恢复 | ✅ | 包含防止内存泄漏的重复操作 |
| **API 桥接** | Preload 脚本注入、API 暴露 | ✅ | 验证 `window.api` 可用性 |

### 2. 数据持久化 (Persistence)
| 功能模块 | 测试点 | 覆盖情况 | 备注 |
|---------|-------|---------|------|
| **配置文件** | 文件生成、默认值 | ✅ | |
| **窗口状态** | 大小、位置保存与恢复 | ✅ | |
| **异常处理** | **JSON 损坏自动修复** | ✅ | **新增**：模拟文件损坏后自动备份重置 |
| **数据校验** | **无效类型兼容** | ✅ | **新增**：验证 Schema 类型不匹配时的稳定性 |

### 3. 系统鲁棒性 (Robustness)
| 测试维度 | 测试场景 | 覆盖情况 | 备注 |
|---------|---------|---------|------|
| **边界值** | **极端窗口尺寸** | ✅ | **新增**：设置 10000x10000 尺寸并验证保存逻辑 |
| **IPC 安全** | **高频通信压力** | ✅ | **新增**：500次连续 IPC 调用 |
| **Crash 防护** | **非法对象传输** | ✅ | **新增**：发送循环引用对象不导致主进程崩溃 |
| **生命周期** | 多次启动/停止 | ✅ | 验证无僵尸进程残留 |

## 优化总结
1.  **移除了低效的特定测试**：删除了 `unit.test.js` 和 `modules.test.js`，这些测试仅做静态文本分析，无法反映运行时行为。
2.  **增强了错误恢复测试**：新增的 `robustness.test.js` 填补了之前关于文件损坏和极端输入的测试空白。
3.  **黑盒测试策略**：改用更可靠的黑盒测试方法（如文件系统验证、UI 状态验证）替代了脆弱的 `evaluate + require` 内部注入测试，大幅提高了测试代码的稳定性。

## 运行方式
```bash
# 运行所有测试
npm test

# 仅运行鲁棒性测试
npx mocha test/robustness.test.js
```
